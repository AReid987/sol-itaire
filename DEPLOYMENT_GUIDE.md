# Sol-itaire Deployment Guide

## Overview

This guide provides step-by-step instructions for deploying the Sol-itaire application. The project consists of:

- **Frontend**: Next.js app deployed to Vercel ✅ (Already deployed)
- **Backend**: Node.js/Express API deployed to Render (Instructions below)
- **Database**: Supabase (Setup instructions below)
- **Tokens**: SPL tokens on Solana blockchain (Already deployed to devnet)

## Current Status

✅ **Frontend**: Successfully deployed to Vercel
- URL: https://web-nidqyg9kr-aigency0.vercel.app
- Repository: https://github.com/AReid987/sol-itaire

✅ **Devnet Tokens**: Already deployed on Solana devnet
- Gaming Token (SOL-IT): 2M4qUmbTiSRtRmfRcnZFWQyNXqkeQ4c9TzCdC7d6svPD
- Memecoin (SOL-COIN): 6ygxtUVufLvihkSm4xv3Ny42ocRmwbMHaJ23kiovFKiH

⏳ **Backend**: Ready for Render deployment
⏳ **Database**: Ready for Supabase setup

## Backend Deployment (Render)

**Answer to your question**: Render doesn't have a CLI like Vercel. Instead, Render uses GitHub integration for automatic deployments. Here's how to deploy:

### Option 1: Using the render.yaml File (Recommended)

I've created a `backend/render.yaml` file that pre-configures everything:

1. **Go to Render Dashboard**: https://dashboard.render.com
2. **Click "New +" → "Web Service"**
3. **Connect GitHub**: Authorize Render to access your repositories
4. **Select Repository**: Choose `AReid987/sol-itaire`
5. **Auto-detect Settings**: Render should detect the `render.yaml` file
6. **Verify Settings**:
   - Name: `sol-itaire-backend`
   - Root Directory: `backend`
   - Build Command: `npm install`
   - Start Command: `npm start`
   - Instance Type: `Free`
7. **Environment Variables**: These should be pre-configured:
   ```
   NODE_ENV=production
   PORT=3001
   SOLANA_NETWORK=devnet
   SOLANA_RPC_URL=https://api.devnet.solana.com
   GAMING_TOKEN_ADDRESS=2M4qUmbTiSRtRmfRcnZFWQyNXqkeQ4c9TzCdC7d6svPD
   MEMECOIN_ADDRESS=6ygxtUVufLvihkSm4xv3Ny42ocRmwbMHaJ23kiovFKiH
   FRONTEND_URL=https://web-nidqyg9kr-aigency0.vercel.app
   JWT_SECRET=<auto-generated>
   ```

8. **Click "Create Web Service"**
9. **Wait for Deployment**: Render will automatically build and deploy your backend

### Option 2: Manual Setup

If you prefer to configure manually:

1. **Create Web Service** in Render Dashboard
2. **Connect GitHub** and select the repository
3. **Configure manually**:
   - Name: `sol-itaire-backend`
   - Environment: `Node`
   - Root Directory: `backend`
   - Build Command: `npm install`
   - Start Command: `npm start`
   - Health Check Path: `/health`
4. **Add Environment Variables** manually (same as above)
5. **Create Service**

### Post-Deployment Steps

1. **Copy Backend URL**: Once deployed, copy the URL (e.g., `https://sol-itaire-backend.onrender.com`)
2. **Update Frontend Environment**: The frontend needs the backend URL for API calls
3. **Test Health Endpoint**: Visit `{your-backend-url}/health` to verify it's working

## Database Setup (Supabase)

Since you have the Supabase CLI, here's how to set it up:

### Option 1: Using Supabase CLI (Recommended)

1. **Install Supabase CLI** (if not already installed):
   ```bash
   npm install -g supabase
   ```

2. **Login to Supabase**:
   ```bash
   supabase login
   ```

3. **Initialize Supabase Project**:
   ```bash
   mkdir supabase
   cd supabase
   supabase init
   ```

4. **Link to Existing Project** (if you have one):
   ```bash
   supabase link --project-ref your-project-id
   ```

5. **Start Local Development**:
   ```bash
   supabase start
   ```

### Option 2: Web Dashboard

1. **Go to Supabase Dashboard**: https://supabase.com/dashboard
2. **Create New Project**
3. **Configure Database**:
   - Region: Choose closest to your users
   - Database Password: Save this securely
4. **Get Project URL**: Copy the project URL and anon key

### Database Schema

The Sol-itaire game needs these tables:

```sql
-- Game sessions
CREATE TABLE games (
  id SERIAL PRIMARY KEY,
  player_address VARCHAR(44) NOT NULL,
  stake_amount DECIMAL(10,8) NOT NULL,
  score INTEGER DEFAULT 0,
  moves INTEGER DEFAULT 0,
  status VARCHAR(20) DEFAULT 'playing',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  completed_at TIMESTAMP
);

-- Game transactions
CREATE TABLE game_transactions (
  id SERIAL PRIMARY KEY,
  game_id INTEGER REFERENCES games(id),
  transaction_hash VARCHAR(88) NOT NULL,
  transaction_type VARCHAR(20) NOT NULL, -- 'start', 'move', 'complete', 'claim'
  created_at TIMESTAMP DEFAULT NOW()
);

-- Player statistics
CREATE TABLE player_stats (
  id SERIAL PRIMARY KEY,
  player_address VARCHAR(44) UNIQUE NOT NULL,
  games_played INTEGER DEFAULT 0,
  games_won INTEGER DEFAULT 0,
  total_earnings DECIMAL(20,8) DEFAULT 0,
  best_time INTEGER DEFAULT 0,
  current_streak INTEGER DEFAULT 0,
  updated_at TIMESTAMP DEFAULT NOW()
);
```

## Frontend Environment Variables

Update the frontend to connect to your deployed backend and database:

1. **Vercel Dashboard**: https://vercel.com/aigency0/web
2. **Settings → Environment Variables**
3. **Add these variables**:
   ```
   NEXT_PUBLIC_SOLANA_NETWORK=devnet
   NEXT_PUBLIC_APP_URL=https://web-nidqyg9kr-aigency0.vercel.app
   NEXT_PUBLIC_BACKEND_URL=https://your-backend-url.onrender.com
   NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   ```

## Next Steps

1. **Deploy Backend to Render** using the instructions above
2. **Set up Supabase Database** using CLI or web dashboard
3. **Update Frontend Environment Variables** with backend and database URLs
4. **Test Integration**: Ensure all services are connected
5. **Deploy to Mainnet**: When ready, switch from devnet to mainnet

## Mainnet Migration (Future)

When you're ready to go to mainnet:

1. **Update Environment Variables**:
   ```
   SOLANA_NETWORK=mainnet-beta
   SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
   ```

2. **Deploy New Tokens** to mainnet (requires ~1 SOL)
3. **Update Token Addresses** in backend and frontend
4. **Update Jupiter DEX Integration** for mainnet token swapping

## Troubleshooting

### Backend Issues
- Check Render logs for deployment errors
- Verify environment variables are set correctly
- Test the `/health` endpoint

### Frontend Issues
- Check Vercel deployment logs
- Verify environment variables are updated
- Check browser console for errors

### Database Issues
- Verify Supabase connection strings
- Check database schema matches the requirements
- Test API endpoints directly

## Support

If you encounter any issues:
1. Check the respective service logs (Vercel, Render, Supabase)
2. Verify all environment variables are correctly set
3. Ensure GitHub repository is up to date
4. Test each service individually before testing integration